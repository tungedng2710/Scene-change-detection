version: "3.8"

services:
  changedetection:
    build: .
    image: changedetection:v1.0
    container_name: changedetection
    restart: always

    # expose FastAPI outside
    ports:
      - "7867:7866"

    # mount the whole repo �~F~R /app
    volumes:
      - ./:/app

    working_dir: /app

    # �~_~T~Q point uvicorn at app.main
    command: >
      uvicorn app.main:app --host 0.0.0.0 --port 7866 --reload
    environment:
      - NVIDIA_VISIBLE_DEVICES=0
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]